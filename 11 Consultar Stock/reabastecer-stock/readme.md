# Reabastecer Stock

Documentación sobre cómo iniciar un proceso desde el API [Link](https://docs.camunda.org/manual/7.9/reference/rest/process-definition/post-start-process-instance/)

Para iniciar el proceso es necesario hacer una llamada al endpoint http://localhost:8080/engine-rest/process-definition/key/ReabastecerStock/start

![BPMN Diagram](process.png)

|   Nr. | Tópico                                          | Actividad                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :---: | :---                                            | :---                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|     1 | **'Obtener códigos de productos' Service Task** | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Configura el parámetro **Connector Id** = 'http-connector'.<br> 3. Agrega los siguientes **Input Parameter**:<br> 3a. **Name** = 'method'. **Type** = 'Text'. **Value** = 'GET'. <br> 3b. **Name** = 'url'. **Type** = 'Text'. **Value** = 'http://localhost:8000/productos'. 4. Agrega los siguientes **Output Parameter**:<br> 4a. **Name** = 'productos'. **Type** = 'Script'. **Script Format** = 'javascript'. **Script Type** = 'Inline Script'. **Script Format** = 'S(response).prop('productos').value()'.                                                                                                                                                                                         |
|     2 | **'Agregar al carro' Service Task**             | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Configura el parámetro **Connector Id** = 'http-connector'.<br> 3. Agrega los siguientes **Input Parameter**:<br> 3a. **Name** = 'method'. **Type** = 'Text'. **Value** = 'GET'. <br> 3a. **Name** = 'url'. **Type** = 'Text'. **Value** = 'http://localhost:8000/compras/agregar'. <br> 3c. **Name** = 'payload'. **Type** = 'Map'. <br> Agregar los siguientes entradas:<br> 3ca. **Key** = 'id'. **Value** = '${id}'. <br> 3ca. **Key** = 'codigo'. **Value** = '${codigo}'.                                                                                                                                                                                                                      |
|     3 | **'Comprar productos' Service Task** | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Configura el parámetro **Connector Id** = 'http-connector'.<br> 3. Agrega los siguientes **Input Parameter**:<br> 3a. **Name** = 'method'. **Type** = 'Text'. **Value** = 'GET'. <br> 3a. **Name** = 'url'. **Type** = 'Text'. **Value** = 'http://localhost:8000/compras/comprar'. <br> 3c. **Name** = 'payload'. **Type** = 'Map'. <br> Agregar el siguientes entrada:<br> 3ca. **Key** = 'id'. **Value** = '${id}'.                                                                                                                                                                                                             |
|     4 | **'Hay stock suficiente?' Call Activity** | 1. Configura el parámetro 'CallActivity Type' = 'BPMN'. <br>  2. Configura el parámetro 'Called element' = 'ConsultStock2'. <br> 3. Configura el parámetro 'binding' = 'latest'. <br> 4. Muévete a la pestaña **Variables**. <br> 5. Agrega los siguientes **In Mappings**:<br> 5a. **Type** = 'Source Expression'. **Source Expression** = 'producto.codigo'. **Target** = 'codigo'. <br> 5b. **Type** = 'Source'. **Source Expression** = 'stockSuficiente'. **Target** = 'stockSuficiente'. |
|     5 | **Sub Process (Secuencial)** | 1. Configura el parámetro 'Collection' = 'productos'. <br>  2. Configura el parámetro 'Element Variable' = 'producto'.|
|     6 | **'Es necesario reponer? sí' flujo**            | 1. Usando el ícono de herramienta, cambia el tipo a 'Default Flow'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|     7 | **'Es necesario reponer? no' flujo**            | 1. Configura el parámetro 'Condition Type' = 'Expression' y 'Expression' = '${stockSuficiente}'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
