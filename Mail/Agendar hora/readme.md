# Agendar Hora

![BPMN Diagram](process.png)

|   Nr. | Tópico                                     | Actividad                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| :---: | :---                                       | :---                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     1 | **'Revisar inbox' Service Task**           | 1. En la pestaña 'general' marca las opciones 'Asynchronous Before' y 'Exclusive'. <br> 2. Configura el parámetro 'Implementation' = 'Connector'. <br> 3. Muévete a la pestaña **Connector**. Haz el atributo **Connector Id** = 'mail-poll'.<br> 3. Agrega el siguiente **Ouput Parameter**:<br> 3a. **Name** = 'mails'. **Type** = 'Text'. **Value** = '${mails}'.                                                                                                                                                                                                                                        |
|     2 | **Subprocess Task**                        | 1. Usando el ícono de herramienta, agrega el parámetro 'Parallel Multi Instance'. <br> 2. En la pestaña 'General', agrega **Collection**='${mails}' y **Element Variable**='mail'.                                                                                                                                                                                                                                                                                                                                                                                                                          |
|     3 | **'Revisar solicitud' User Task** | 1. En la pestaña 'Forms' agrega dos variables del siguiente modo:<br> 1a. **ID** = 'correo', **Type** = 'string', **Label** = 'Solicitud', **Default value** = `${mail.getText()}`.<br> 1b. **ID** = 'agendar', **Type** = 'boolean', **Label** = 'Agendar hora?'.                                                                                                                                                                                                                                                                                                                                        |
|     4 | **'Notificar hora tomada' Send Task**       | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Haz el atributo **Connector Id** = 'mail-send'.<br> 3. Agrega los siguientes **Input Parameters**:<br> 3a. **Name** = 'to'. **Type** = 'Text'. **Value** = `${mail.getFrom()}`. <br> 3b. **Name** = 'subject'. **Type** = 'Text'. **Value** = `${'RE: '.concat(mail.getSubject())}`. <br> 3c. **Name** = 'text'. **Type** = 'Script'. **Script Format** = 'freemarker'. **Script Type** = 'Inline Script'. **Value** = 'Buenos días<br><br>Su hora ha sido agendada.<br><br>Saludos! |
|     5 | **'Notificar hora no tomada' Send Task**    | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Haz el atributo **Connector Id** = 'mail-send'.<br> 3. Agrega los siguientes **Input Parameters**:<br> 3a. **Name** = 'to'. **Type** = 'Text'. **Value** = `${mail.getFrom()}`. <br> 3b. **Name** = 'subject'. **Type** = 'Text'. **Value** = `${'RE: '.concat(mail.getSubject())}`. <br> 3c. **Name** = 'text'. **Type** = 'Script'. **Script Format** = 'freemarker'. **Script Type** = 'Inline Script'. **Value** = 'Buenas días<br><br>La hora solicitada no está disponible. Por favor, solicite otra hora<br><br>Saludos! |
|     6 | **'Borrar Correo' Service Task**           | 1. Configura el parámetro 'Implementation' = 'Connector'. <br> 2. Muévete a la pestaña **Connector**. Configura el parámetro **Connector Id** = 'mail-delete'.<br> 3. Agrega los siguientes **Input Parameter**:<br> 3a. **Name** = 'mails'. **Type** = 'List'. **Value** = '${mail}'.                                                                                                                                                                                                                                                                                                                      |
|     6 | **'Asignar la hora? sí'** flujo  | 1. Configura el parámetro 'Condition Type' = 'Expression' y 'Expression' = '${agendar}'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|     7 | **'Asignar la hora? no' flujo** | 1. Usando el ícono de herramienta, cambia el tipo a 'Default Flow'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
