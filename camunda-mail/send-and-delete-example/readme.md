# Send email Example

![BPMN Diagram](process.png)

|   Nr. | Topic                                 | Activity                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| :---: | :---                                  | :---                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|     1 | **'Revisar inbox' Service Task**      | 1. In 'General' tab, check 'Asynchronous Before' and 'Exclusive' boxes. <br> 2. Set the field 'Implementation' = 'Connector'. <br> 3. Switch to the **Connector** tab. Set the **Connector Id** = 'mail-poll'.<br> 3. Add the following **Ouput Parameter**:<br> 3a. **Name** = 'mails'. **Type** = 'Text'. **Value** = '${mails}'. <br>|
|     2 | **Subprocess Task**   | 1. Using the tool icon add the 'Parallel Multi Instance' parameter. <br> 2. In 'General' tab, set **Collection**='${mails}' and **Element Variable**='mail'. |
|     3 | **'Consultar tiempo' Service Task**   | 1. Set the field 'Implementation' = 'Connector'. <br> 2. Switch to the **Connector** tab. Set the **Connector Id** = 'http-connector'.<br> 3. Add the following **Input Parameters**:<br> 3a. **Name** = 'method'. **Type** = 'Text'. **Value** = 'GET'. <br> 3b. **Name** = 'url'. **Type** = 'Script'. **Script Format** = 'freemarker'. **Script Type** = 'Inline Script'. **Script** = 'http://178.62.33.94:8000/weatherOk/${cityName}'. |
|     4 | **'Avisar buen tiempo' Service Task** | 1. Set the field 'Implementation' = 'Connector'. <br> 2. Switch to the **Connector** tab. Set the **Connector Id** = 'mail-send'.<br> 3. Add the following **Input Parameters**:<br> 3a. **Name** = 'to'. **Type** = 'Text'. **Value** = '${mail.getFrom()}'. <br> 3b. **Name** = 'subject'. **Type** = 'Text'. **Value** = '${'RE: '.concat(mail.getSubject())}'. <br> 3c. **Name** = 'text'. **Type** = 'Script'. **Script Format** = 'freemarker'. **Script Type** = 'Inline Script'. **Value** = 'Hola <br><br>Mister Camunda le informa que el tiempo en ${mail.getSubject()} está bueno.<br><br>Saludos!'. |
|     5 | **'Avisar mal tiempo' Service Task**  | 1. Set the field 'Implementation' = 'Connector'. <br> 2. Switch to the **Connector** tab. Set the **Connector Id** = 'mail-send'.<br> 3. Add the following **Input Parameters**:<br> 3a. **Name** = 'to'. **Type** = 'Text'. **Value** = '${mail.getFrom()}'. <br> 3b. **Name** = 'subject'. **Type** = 'Text'. **Value** = '${'RE: '.concat(mail.getSubject())}'. <br> 3c. **Name** = 'text'. **Type** = 'Script'. **Script Format** = 'freemarker'. **Script Type** = 'Inline Script'. **Value** = 'Hola <br><br>Mister Camunda le informa que el tiempo en ${mail.getSubject()} está malo.<br><br>Saludos!'. |
|     6 | **'Borrar Correo' Service Task**      | 1. Set the field 'Implementation' = 'Connector'. <br> 2. Switch to the **Connector** tab. Set the **Connector Id** = 'mail-delete'.<br> 3. Add the following **Input Parameter**:<br> 3a. **Name** = 'mails'. **Type** = 'List'. **Value** = '${mail}'.|
|     6 | **'Weather ok? Yes' Sequence Flow**   | 1. Set the field 'Condition Type' = 'Expression' and 'Expression' = '#{weatherOk}'. |
|     7 | **'Weather ok? No' Sequence Flow**    | 1. Using the tool icon change its type to a 'Default Flow'. |
